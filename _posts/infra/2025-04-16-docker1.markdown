---
layout: content-layout
title: "DOCKER 간단하게 알아보기!🤤"
date: 2025-04-16
categories: [INFRA]
tags: [INFRA, DOCKER, 도커]
---

## 안녕하십니까! 😀


---

# Docker 기본 개념 학습

1. 컨테이너 가상화 기술
- 하이퍼바이저 가상화
- 컨테이너 가상화

2. 도커 이미지
- 이미지 한 개는 여러 개의 컨테이너를 실행할 수 있다.
- 컨테이너의 이미지의 메타데이터 기반으로 실행 처리 된다.
- 컨테이너의 라이프사이클은 생성(Created) -> 실행(Runnung) <-> 종료 (Stopped) 또는 -> 일시정지 (Paused) -> 삭제 (Deleted)

3. 이미지 빌드
- 도커 이미지는 여러 개의 레이어로 구성되어 있다.
- 이미지는 다음과 같이 새롭게 만들 수 있다.
  - Nginx 이미지를 컨테이너로 실행
  - 컨테이너의 내부 파일 변경
  - Commit으로 새로운 이미지로 저장
- 이미지를 쉽게 만들기 위해 Dockerfile이 존재한다. (FROM, COPY, RUN, CMD 크게 4가지 명령어)
- 불필요한 파일 제외가 필요한 경우 .dockerignore 를 사용하면 된다.
- **멀티 스테이지 빌드** 는 여러 개의 FROM 명령어를 사용하여 최종 이미지를 만들어내는 방식
  - ex) FROM openjdk:11, FROM maven:3.6
  - 멀티 스테이지를 잘 활용하면 어플리케이션 크기를 줄일 수 있다.

4. 컨테이너 어플리케이션 구성

|항목|모놀리식 아키텍처|마이크로서비스 아키텍처|
|----|----|----|
|구조|단일 코드베이스와 애플리케이션|기능별로 독립된 서비스|
|배포|전체 재배포 필요|개별 서비스 독립 배포|
|확장성|수직 확장을 주로 사용|수평 확장 용이|
|개발 속도|초반 개발 속도 빠름|초기 구성 복잡하고 오래 걸림|
|장애 영향도|전체 애플리케이션 영향|영향이 적고 분리 가능|
|기술 스택|일반적으로 하나의 스택|서비스별 다양한 스택 가능|
|유지보수|전체 코드 이해 필요|각 서비스 별로 개발 및 유지보수|
|복잡성|낮음|서비스 간 통신, 데이터 일관성 유지 등 복잡성 매우 높음|

5. 도커 네트워크
- 라우터 내부 사설 IP가 외부 서버와 통신하려면? NAT와 포트포워딩 기술 필요
- 도커는 동일 브릿지에선 통신이 가능하나 타 브릿지로는 통신이 불가능하다.
- 컨테이너를 재시작하면 할당 IP가 변경될 수 있다. 네트워크 접근시 컨테이너명으로 접근하는 것을 추천한다.

6. 스토리지와 볼륨

|기준|Pet 방식|Cattle 방식|
|----|----|----|
|방식|전통적, VM 방식|컨테이너 방식|
|이름|고유한 이름을 가짐|랜덤한 일련번호 생성|
|문제 발생 시|문제 해결 또는 복구 시도|삭제 후 새로 생성|
|상태|상태가 내부에 저장|상태 없음, 필요 시 외부 마운트|
|교체|교체가 어려움|쉽게 교체|
|적용 사례|Monolithic, OnPremise|MSA, WEBAPP|

**✏️ 도커는 소모품 방식인 만큼 중요 데이터가 손실되지 않도록 해야 한다. (특히 DB)**
- 볼륨을 설정하여 처리한다.

7. 기타 실무에 필요한 TIP
- 빌드 속도 개선 방법
  - alpine 버전 이미지는 가장 사이즈가 작은 버전이다.
  - .dockerignore를 활용하여 불필요한 파일은 빌드에서 제외한다.
  - GOLANG 등 단일 실행이 가능한 언어로 이미지를 구성한다.
  - 레이어 배치에 따라 캐싱이 적용되어 빌드 속도가 빨라지니 잘 배치해야 한다.
- 3 Tier 아키텍처 구성으로 적용하여 Backend 직접 접근을 차단한다.
- DB 이중화를 구성하여 장애 발생시 대처할 수 있게 설계한다.
- Java Heap 메모리는 통상 컨테이너의 50~70% 정도의 메모리로 설정해야 안전하다.
- 컨테이너 개발 환경을 구축하여 운영 환경과 동일한 환경에서 개발할 수 있도록 변경한다.
- 도커 허브에 올라간 이미지는 쿠버네티스에서 Pod 생성에 사용되고 추후 소스 변경시 ArgoCD 같은 배포 도구에 의해 동기화되어 배포할 수 있다.


다음에는 다른 것으로 돌아오겠습니다!

긴 글 봐주셔서 감사합니다! 😌